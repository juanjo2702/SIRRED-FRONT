import{z as d,f as q,n as N,o as R,c as D,w as l,H as s,a as t,Q as C,I as p,Z as L,N as Q,J as F,M as x,L as U}from"./index.0418bc8d.js";import{Q as _}from"./QSelect.e99ebc92.js";import{a as k,b as z}from"./QItem.b86f3ea8.js";import{Q as O}from"./QFile.c07894a4.js";import{Q as P}from"./QBanner.09124be8.js";import{Q as T}from"./QForm.0e8df789.js";import{Q as M}from"./QPage.c34053e1.js";import{u as j}from"./use-quasar.d200e14e.js";import{api as S}from"./axios.0ee954dc.js";import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";import"./QChip.9d792c62.js";import"./position-engine.40d3e3b8.js";const H={name:"UploadPage",setup(){const c=j(),e=d([]),g=d([]),o=d(null),f=d(null),b=d(null),a=d(null),y=d(!1),m=d([]),v=d([]),A=q(()=>g.value.find(r=>r.estado===1)),I=async()=>{try{const r=localStorage.getItem("token"),n=await S.get("/sedes",{headers:{Authorization:`Bearer ${r}`}});e.value=n.data}catch{c.notify({type:"negative",message:"Error al cargar sedes"})}},V=async()=>{try{const r=localStorage.getItem("token"),n=await S.get("/cortes",{headers:{Authorization:`Bearer ${r}`}});g.value=n.data}catch{c.notify({type:"negative",message:"Error al cargar cortes"})}},h=()=>{var r;f.value=null,o.value?(m.value=((r=o.value.sede_carreras)==null?void 0:r.map(n=>{var i;return{id:n.id,nombre:(i=n.carrera)==null?void 0:i.nombre}}))||[],v.value=[...m.value]):(m.value=[],v.value=[])},w=(r,n)=>{n(()=>{if(r==="")v.value=m.value;else{const i=r.toLowerCase();v.value=m.value.filter(u=>u.nombre.toLowerCase().indexOf(i)>-1)}})},E=()=>{c.notify({type:"negative",message:"Archivo rechazado. Verifique el formato y tama\xF1o (m\xE1x 5MB)"})},B=async()=>{var r,n;if(!A.value){c.notify({type:"warning",message:"No hay corte activo"});return}y.value=!0;try{const i=localStorage.getItem("token"),u=new FormData;u.append("file",a.value),u.append("sede_carrera_id",f.value.id),u.append("tipo_contrato",b.value),await S.post("/facturaciones/upload-excel",u,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"multipart/form-data"}}),c.notify({type:"positive",message:"Datos importados correctamente"}),o.value=null,f.value=null,b.value=null,a.value=null}catch(i){c.notify({type:"negative",message:((n=(r=i.response)==null?void 0:r.data)==null?void 0:n.message)||"Error al importar datos"})}finally{y.value=!1}};return N(()=>{I(),V()}),{sedes:e,cortes:g,selectedSede:o,selectedCarrera:f,tipoContrato:b,file:a,uploading:y,corteActivo:A,allCarreras:m,filteredCarreras:v,loadCarrerasBySede:h,filterCarreras:w,onFileRejected:E,uploadExcel:B}}},J={class:"row items-center"},Z={class:"text-h6"},K={class:"row q-col-gutter-md"},W={class:"col-12 col-md-6"},X={class:"col-12 col-md-6"},Y={class:"col-12 col-md-6"},$={class:"col-12 col-md-6"},ee={class:"q-mt-md"};function oe(c,e,g,o,f,b){return R(),D(M,{padding:""},{default:l(()=>[e[9]||(e[9]=s("div",{class:"q-mb-md"},[s("div",{class:"text-h5 text-weight-medium"},"Subir Datos de Docentes"),s("div",{class:"text-caption text-grey-7"},"Cargue la informaci\xF3n de docentes mediante archivo Excel")],-1)),t(Q,{class:"q-mb-md shadow-2",flat:"",bordered:""},{default:l(()=>[t(C,{class:"bg-teal text-white"},{default:l(()=>{var a;return[s("div",J,[t(p,{name:"event",size:"28px",class:"q-mr-sm"}),s("div",null,[e[4]||(e[4]=s("div",{class:"text-subtitle2"},"Corte Activo",-1)),s("div",Z,L(((a=o.corteActivo)==null?void 0:a.nombre)||"Ninguno"),1)])])]}),_:1})]),_:1}),t(Q,{class:"shadow-2",flat:"",bordered:""},{default:l(()=>[t(C,{class:"bg-grey-2"},{default:l(()=>[...e[5]||(e[5]=[s("div",{class:"text-h6 text-grey-8"},"Informaci\xF3n de Carga",-1)])]),_:1}),t(F),t(C,{class:"q-pa-md"},{default:l(()=>[t(T,{onSubmit:o.uploadExcel},{default:l(()=>[s("div",K,[s("div",W,[t(_,{modelValue:o.selectedSede,"onUpdate:modelValue":[e[0]||(e[0]=a=>o.selectedSede=a),o.loadCarrerasBySede],options:o.sedes,"option-label":"nombre","option-value":"id",label:"Seleccionar Sede",outlined:"",rules:[a=>!!a||"Requerido"]},{prepend:l(()=>[t(p,{name:"location_city"})]),_:1},8,["modelValue","options","onUpdate:modelValue","rules"])]),s("div",X,[t(_,{modelValue:o.selectedCarrera,"onUpdate:modelValue":e[1]||(e[1]=a=>o.selectedCarrera=a),options:o.filteredCarreras,"option-label":"nombre","option-value":"id",label:"Seleccionar Carrera",outlined:"","use-input":"","input-debounce":"300",onFilter:o.filterCarreras,disable:!o.selectedSede,rules:[a=>!!a||"Requerido"]},{prepend:l(()=>[t(p,{name:"school"})]),"no-option":l(()=>[t(k,null,{default:l(()=>[t(z,{class:"text-grey"},{default:l(()=>[...e[6]||(e[6]=[x(" No se encontraron carreras ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options","onFilter","disable","rules"])]),s("div",Y,[t(_,{modelValue:o.tipoContrato,"onUpdate:modelValue":e[2]||(e[2]=a=>o.tipoContrato=a),options:["FACTURACION","RETENCION","AFILIACION"],label:"Tipo de Contrato",outlined:"",rules:[a=>!!a||"Requerido"]},{prepend:l(()=>[t(p,{name:"description"})]),_:1},8,["modelValue","rules"])]),s("div",$,[t(O,{modelValue:o.file,"onUpdate:modelValue":e[3]||(e[3]=a=>o.file=a),label:"Archivo Excel",outlined:"",accept:".xlsx, .xls",rules:[a=>!!a||"Requerido"],"max-file-size":"5242880",onRejected:o.onFileRejected},{prepend:l(()=>[t(p,{name:"attach_file"})]),hint:l(()=>[...e[7]||(e[7]=[x(" Tama\xF1o m\xE1ximo: 5MB ",-1)])]),_:1},8,["modelValue","rules","onRejected"])])]),t(P,{class:"bg-blue-1 text-blue-9 q-mt-md",rounded:""},{avatar:l(()=>[t(p,{name:"info",color:"blue"})]),default:l(()=>[e[8]||(e[8]=x(" El archivo Excel debe contener las columnas: 1\xBA APELLIDO, 2\xBA APELLIDO, NOMBRE(S), CI, CARGA PAGADA, LIQUIDO PAGABLE ",-1))]),_:1}),s("div",ee,[t(U,{type:"submit",label:"Subir Datos",color:"primary",icon:"upload",loading:o.uploading,disable:!o.corteActivo,unelevated:"",size:"md"},null,8,["loading","disable"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1})}var fe=G(H,[["render",oe]]);export{fe as default};
