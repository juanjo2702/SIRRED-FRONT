import{z as d,f as E,n as R,o as D,c as N,w as r,H as f,a as l,L as m,I as L,K as p,M as y,Z as Q,N as P,Q as h,b5 as M}from"./index.0418bc8d.js";import{Q as T}from"./QBadge.81599d26.js";import{Q as _,a as G}from"./QTable.17f2e81d.js";import{Q as C}from"./QTooltip.616e6e1b.js";import{Q as j}from"./QSelect.e99ebc92.js";import{Q as F}from"./QForm.0e8df789.js";import{Q as H}from"./QPage.c34053e1.js";import{u as K}from"./use-quasar.d200e14e.js";import{api as c}from"./axios.0ee954dc.js";import{_ as O}from"./plugin-vue_export-helper.21dcd24c.js";import"./QList.329cacdc.js";import"./position-engine.40d3e3b8.js";import"./QChip.9d792c62.js";import"./QItem.b86f3ea8.js";const Z={name:"UsersPage",setup(){const i=K(),o=d([]),b=d([]),a=d(!1),g=d(!1),v=d(!1),e=d(!1),n=d({name:"",apellidos:"",ci:"",role_id:null}),w=d(""),q=[{name:"name",label:"Nombre",field:"name",align:"left",sortable:!0},{name:"apellidos",label:"Apellidos",field:"apellidos",align:"left",sortable:!0},{name:"ci",label:"CI",field:"ci",align:"left",sortable:!0},{name:"role",label:"Rol",field:t=>{var s;return(s=t.role)==null?void 0:s.nombre},align:"left",sortable:!0},{name:"status",label:"Estado",field:"status",align:"center"},{name:"actions",label:"Acciones",align:"center"}],x=E(()=>{if(!w.value)return o.value;const t=w.value.toLowerCase();return o.value.filter(s=>{var u,U,V;return((u=s.name)==null?void 0:u.toLowerCase().includes(t))||((U=s.apellidos)==null?void 0:U.toLowerCase().includes(t))||((V=s.ci)==null?void 0:V.toLowerCase().includes(t))})}),k=async()=>{a.value=!0;try{const t=localStorage.getItem("token"),s=await c.get("/users",{headers:{Authorization:`Bearer ${t}`}});o.value=s.data}catch{i.notify({type:"negative",message:"Error al cargar usuarios"})}finally{a.value=!1}},B=async()=>{try{const t=localStorage.getItem("token"),s=await c.get("/roles",{headers:{Authorization:`Bearer ${t}`}});b.value=s.data}catch{i.notify({type:"negative",message:"Error al cargar roles"})}},I=async()=>{var t,s;g.value=!0;try{const u=localStorage.getItem("token");e.value?(await c.put(`/users/${n.value.id}`,n.value,{headers:{Authorization:`Bearer ${u}`}}),i.notify({type:"positive",message:"Usuario actualizado"})):(await c.post("/users",n.value,{headers:{Authorization:`Bearer ${u}`}}),i.notify({type:"positive",message:"Usuario creado"})),v.value=!1,k(),n.value={name:"",apellidos:"",ci:"",role_id:null}}catch(u){i.notify({type:"negative",message:((s=(t=u.response)==null?void 0:t.data)==null?void 0:s.message)||"Error al guardar"})}finally{g.value=!1}},S=t=>{n.value={...t},e.value=!0,v.value=!0},A=async t=>{i.dialog({title:"Confirmar",message:`\xBFRestablecer contrase\xF1a de ${t.name}?`,cancel:!0}).onOk(async()=>{try{const s=localStorage.getItem("token");await c.post(`/users/${t.id}/reset-password`,{},{headers:{Authorization:`Bearer ${s}`}}),i.notify({type:"positive",message:"Contrase\xF1a restablecida"})}catch{i.notify({type:"negative",message:"Error al restablecer contrase\xF1a"})}})},z=async t=>{try{const s=localStorage.getItem("token");await c.post(`/users/${t.id}/toggle-status`,{},{headers:{Authorization:`Bearer ${s}`}}),i.notify({type:"positive",message:"Estado actualizado"}),k()}catch{i.notify({type:"negative",message:"Error al actualizar estado"})}};return R(()=>{k(),B()}),{users:o,roles:b,loading:a,saving:g,showDialog:v,editMode:e,form:n,columns:q,searchQuery:w,filteredUsers:x,saveUser:I,editUser:S,resetPassword:A,toggleStatus:z}}},J={class:"q-mb-md"},W={class:"row justify-between items-center q-mb-md"},X={class:"text-h6"},Y={class:"row q-gutter-sm"};function $(i,o,b,a,g,v){return D(),N(H,{padding:""},{default:r(()=>[f("div",J,[f("div",W,[o[8]||(o[8]=f("div",{class:"text-h5 text-weight-medium"},"Gesti\xF3n de Usuarios",-1)),l(m,{color:"primary",label:"Nuevo Usuario",icon:"add",onClick:o[0]||(o[0]=e=>a.showDialog=!0),unelevated:""})]),l(p,{modelValue:a.searchQuery,"onUpdate:modelValue":o[1]||(o[1]=e=>a.searchQuery=e),outlined:"",dense:"",placeholder:"Buscar por nombre, apellidos o CI...",class:"q-mb-md",clearable:"",style:{"max-width":"400px"}},{prepend:r(()=>[l(L,{name:"search"})]),_:1},8,["modelValue"])]),l(G,{rows:a.filteredUsers,columns:a.columns,"row-key":"id",loading:a.loading,flat:"",bordered:"","rows-per-page-options":[10,25,50],class:"shadow-1"},{"body-cell-status":r(e=>[l(_,{props:e},{default:r(()=>[l(T,{color:e.row.status?"positive":"negative"},{default:r(()=>[y(Q(e.row.status?"Activo":"Inactivo"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-actions":r(e=>[l(_,{props:e},{default:r(()=>[l(m,{flat:"",dense:"",color:"primary",icon:"edit",onClick:n=>a.editUser(e.row)},{default:r(()=>[l(C,null,{default:r(()=>[...o[9]||(o[9]=[y("Editar",-1)])]),_:1})]),_:1},8,["onClick"]),l(m,{flat:"",dense:"",color:"warning",icon:"lock_reset",onClick:n=>a.resetPassword(e.row)},{default:r(()=>[l(C,null,{default:r(()=>[...o[10]||(o[10]=[y("Restablecer Contrase\xF1a",-1)])]),_:1})]),_:1},8,["onClick"]),l(m,{flat:"",dense:"",color:e.row.status?"negative":"positive",icon:e.row.status?"block":"check_circle",onClick:n=>a.toggleStatus(e.row)},{default:r(()=>[l(C,null,{default:r(()=>[y(Q(e.row.status?"Desactivar":"Activar"),1)]),_:2},1024)]),_:2},1032,["color","icon","onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"]),l(M,{modelValue:a.showDialog,"onUpdate:modelValue":o[7]||(o[7]=e=>a.showDialog=e)},{default:r(()=>[l(P,{style:{"min-width":"400px"}},{default:r(()=>[l(h,{class:"bg-primary text-white"},{default:r(()=>[f("div",X,Q(a.editMode?"Editar Usuario":"Nuevo Usuario"),1)]),_:1}),l(h,null,{default:r(()=>[l(F,{onSubmit:a.saveUser},{default:r(()=>[l(p,{modelValue:a.form.name,"onUpdate:modelValue":o[2]||(o[2]=e=>a.form.name=e),label:"Nombre",outlined:"",dense:"",class:"q-mb-md",rules:[e=>!!e||"Requerido"]},null,8,["modelValue","rules"]),l(p,{modelValue:a.form.apellidos,"onUpdate:modelValue":o[3]||(o[3]=e=>a.form.apellidos=e),label:"Apellidos",outlined:"",dense:"",class:"q-mb-md",rules:[e=>!!e||"Requerido"]},null,8,["modelValue","rules"]),l(p,{modelValue:a.form.ci,"onUpdate:modelValue":o[4]||(o[4]=e=>a.form.ci=e),label:"CI",outlined:"",dense:"",class:"q-mb-md",rules:[e=>!!e||"Requerido"]},null,8,["modelValue","rules"]),l(j,{modelValue:a.form.role_id,"onUpdate:modelValue":o[5]||(o[5]=e=>a.form.role_id=e),options:a.roles,"option-label":"nombre","option-value":"id","emit-value":"","map-options":"",label:"Rol",outlined:"",dense:"",class:"q-mb-md",rules:[e=>!!e||"Requerido"]},null,8,["modelValue","options","rules"]),f("div",Y,[l(m,{label:"Cancelar",color:"grey",flat:"",onClick:o[6]||(o[6]=e=>a.showDialog=!1)}),l(m,{type:"submit",label:"Guardar",color:"primary",loading:a.saving},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ge=O(Z,[["render",$]]);export{ge as default};
