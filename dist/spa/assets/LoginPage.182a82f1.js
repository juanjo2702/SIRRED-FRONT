import{G as V,z as t,o as b,c as x,w as r,H as i,a as o,Q as w,I as l,J as S,K as p,L as C,M as I,N as Q}from"./index.0418bc8d.js";import{Q as _}from"./QForm.0e8df789.js";import{Q as N}from"./QPage.c34053e1.js";import{u as z}from"./use-quasar.d200e14e.js";import{api as f}from"./axios.0ee954dc.js";import{_ as B}from"./plugin-vue_export-helper.21dcd24c.js";const U={name:"LoginPage",setup(){const d=z(),e=V(),g=t(""),a=t(""),v=t(""),y=t(""),s=t(!1),P=t(!1),u=t(""),h=t(!1),q=t(!1),k=t(!1);return{ci:g,password:a,newPassword:v,confirmPassword:y,loading:s,forceChangePassword:P,showPassword:h,showNewPassword:q,showConfirmPassword:k,login:async()=>{var m,c;s.value=!0;try{const n=await f.post("/login",{ci:g.value,password:a.value});n.data.force_change_password?(P.value=!0,u.value=n.data.access_token,d.notify({type:"warning",message:"Debe cambiar su contrase\xF1a en el primer inicio de sesi\xF3n"})):(localStorage.setItem("token",n.data.access_token),localStorage.setItem("user",JSON.stringify(n.data.user)),f.defaults.headers.common.Authorization=`Bearer ${n.data.access_token}`,d.notify({type:"positive",message:"Bienvenido"}),e.push("/"))}catch(n){d.notify({type:"negative",message:((c=(m=n.response)==null?void 0:m.data)==null?void 0:c.message)||"Error al iniciar sesi\xF3n"})}finally{s.value=!1}},changePassword:async()=>{var m,c;s.value=!0;try{await f.post("/change-password",{password:v.value,password_confirmation:y.value},{headers:{Authorization:`Bearer ${u.value}`}}),localStorage.setItem("token",u.value),f.defaults.headers.common.Authorization=`Bearer ${u.value}`,d.notify({type:"positive",message:"Contrase\xF1a actualizada correctamente"}),e.push("/")}catch(n){d.notify({type:"negative",message:((c=(m=n.response)==null?void 0:m.data)==null?void 0:c.message)||"Error al cambiar contrase\xF1a"})}finally{s.value=!1}}}}},L={class:"login-container"},R={class:"logo-container q-mb-md"},T={class:"text-center q-mb-md"};function A(d,e,g,a,v,y){return b(),x(N,{class:"flex flex-center login-page"},{default:r(()=>[i("div",L,[o(Q,{class:"login-card",flat:"",bordered:""},{default:r(()=>[o(w,{class:"text-center q-pt-xl q-pb-lg"},{default:r(()=>[i("div",R,[o(l,{name:"school",size:"64px",color:"primary"})]),e[7]||(e[7]=i("div",{class:"text-h4 text-weight-bold text-primary q-mb-xs"},"SIRRED",-1)),e[8]||(e[8]=i("div",{class:"text-subtitle1 text-grey-7"},"Universidad T\xE9cnica Privada Cosmos",-1)),e[9]||(e[9]=i("div",{class:"text-caption text-grey-6"},"Sistema de Registro de Respaldos Docentes",-1))]),_:1}),o(S),a.forceChangePassword?(b(),x(w,{key:1,class:"q-pa-xl"},{default:r(()=>[i("div",T,[o(l,{name:"lock_reset",size:"48px",color:"warning"}),e[11]||(e[11]=i("div",{class:"text-h6 text-weight-medium q-mt-sm"},"Cambiar Contrase\xF1a",-1)),e[12]||(e[12]=i("div",{class:"text-caption text-grey-7"},"Por seguridad, debe cambiar su contrase\xF1a",-1))]),o(_,{onSubmit:a.changePassword,class:"q-gutter-md"},{default:r(()=>[o(p,{modelValue:a.newPassword,"onUpdate:modelValue":e[4]||(e[4]=s=>a.newPassword=s),label:"Nueva Contrase\xF1a",type:a.showNewPassword?"text":"password",outlined:"",rules:[s=>!!s||"Contrase\xF1a es requerida",s=>s.length>=6||"M\xEDnimo 6 caracteres"]},{prepend:r(()=>[o(l,{name:"vpn_key",color:"primary"})]),append:r(()=>[o(l,{name:a.showNewPassword?"visibility_off":"visibility",class:"cursor-pointer",onClick:e[3]||(e[3]=s=>a.showNewPassword=!a.showNewPassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),o(p,{modelValue:a.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=s=>a.confirmPassword=s),label:"Confirmar Contrase\xF1a",type:a.showConfirmPassword?"text":"password",outlined:"",rules:[s=>!!s||"Confirmaci\xF3n es requerida",s=>s===a.newPassword||"Las contrase\xF1as no coinciden"]},{prepend:r(()=>[o(l,{name:"check_circle",color:"primary"})]),append:r(()=>[o(l,{name:a.showConfirmPassword?"visibility_off":"visibility",class:"cursor-pointer",onClick:e[5]||(e[5]=s=>a.showConfirmPassword=!a.showConfirmPassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),o(C,{type:"submit",label:"Cambiar Contrase\xF1a",color:"primary",size:"lg",class:"full-width q-mt-md",loading:a.loading,unelevated:""},null,8,["loading"])]),_:1},8,["onSubmit"])]),_:1})):(b(),x(w,{key:0,class:"q-pa-xl"},{default:r(()=>[e[10]||(e[10]=i("div",{class:"text-h6 text-weight-medium q-mb-md text-center"},"Iniciar Sesi\xF3n",-1)),o(_,{onSubmit:a.login,class:"q-gutter-md"},{default:r(()=>[o(p,{modelValue:a.ci,"onUpdate:modelValue":e[0]||(e[0]=s=>a.ci=s),label:"C\xE9dula de Identidad",outlined:"",rules:[s=>!!s||"CI es requerido"]},{prepend:r(()=>[o(l,{name:"badge",color:"primary"})]),_:1},8,["modelValue","rules"]),o(p,{modelValue:a.password,"onUpdate:modelValue":e[2]||(e[2]=s=>a.password=s),label:"Contrase\xF1a",type:a.showPassword?"text":"password",outlined:"",autocomplete:"current-password",rules:[s=>!!s||"Contrase\xF1a es requerida"]},{prepend:r(()=>[o(l,{name:"lock",color:"primary"})]),append:r(()=>[o(l,{name:a.showPassword?"visibility_off":"visibility",class:"cursor-pointer",onClick:e[1]||(e[1]=s=>a.showPassword=!a.showPassword)},null,8,["name"])]),_:1},8,["modelValue","type","rules"]),o(C,{type:"submit",label:"Iniciar Sesi\xF3n",color:"primary",size:"lg",class:"full-width q-mt-md",loading:a.loading,unelevated:""},null,8,["loading"])]),_:1},8,["onSubmit"])]),_:1})),o(w,{class:"text-center text-caption text-grey-6 q-pb-md"},{default:r(()=>[...e[13]||(e[13]=[I(" \xA9 2025 Universidad T\xE9cnica Privada Cosmos ",-1)])]),_:1})]),_:1})])]),_:1})}var O=B(U,[["render",A],["__scopeId","data-v-c5b1a456"]]);export{O as default};
