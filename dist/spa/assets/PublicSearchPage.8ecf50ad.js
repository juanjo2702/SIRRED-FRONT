import{W as I,G as N,z as x,n as A,o as d,c as q,w as o,a as s,Q as v,H as e,K as E,L as y,X as f,I as p,N as h,Y as U,Z as r,M as b,_ as j,$ as L,a0 as F}from"./index.0418bc8d.js";import{Q as T}from"./QForm.0e8df789.js";import{Q as S}from"./QBadge.81599d26.js";import{Q as C}from"./QBanner.09124be8.js";import{Q as B}from"./QFile.c07894a4.js";import{Q as V}from"./QTooltip.616e6e1b.js";import{Q as O}from"./QPage.c34053e1.js";import{u as M}from"./use-quasar.d200e14e.js";import{api as k}from"./axios.0ee954dc.js";import{_ as G}from"./plugin-vue_export-helper.21dcd24c.js";import"./QChip.9d792c62.js";import"./position-engine.40d3e3b8.js";const W={name:"PublicSearchPage",setup(){const _=M(),t=I(),D=N(),l=x(""),w=x(!1),g=x(null),a=x(!1),n=x({}),R=async(i=!1)=>{var c;w.value=!0,i||(g.value=null),a.value=!1;try{D.replace({query:{...t.query,ci:l.value}});const u=await k.get("/public/search",{params:{ci:l.value}});g.value=u.data,g.value.facturaciones.forEach(m=>{m.file=null})}catch(u){if(((c=u.response)==null?void 0:c.status)===404){const m=u.response.data.message;m.includes("corte activo")?a.value=!0:_.notify({type:"warning",message:m})}else _.notify({type:"negative",message:"Error al buscar"})}finally{w.value=!1}},Q=async i=>{var c,u;if(!!i.file){n.value[i.id]=!0;try{const m=new FormData;m.append("factura",i.file),await k.post(`/public/facturaciones/${i.id}/upload`,m,{headers:{"Content-Type":"multipart/form-data"}}),_.notify({type:"positive",message:"Factura subida correctamente"}),R(!0)}catch(m){_.notify({type:"negative",message:((u=(c=m.response)==null?void 0:c.data)==null?void 0:u.message)||"Error al subir factura"})}finally{n.value[i.id]=!1}}},z=i=>{_.dialog({title:"Confirmar Reemplazo",message:"\xBFEst\xE1 seguro de que desea reemplazar su factura actual? La factura anterior ser\xE1 eliminada y deber\xE1 esperar una nueva revisi\xF3n.",cancel:{label:"Cancelar",color:"grey",flat:!0},ok:{label:"S\xED, Reemplazar",color:"warning",flat:!0},persistent:!0}).onOk(()=>{Q(i)})},P=()=>{_.notify({type:"negative",message:"El archivo debe ser PDF y no superar 2MB"})};return A(()=>{t.query.ci&&(l.value=t.query.ci,R())}),{ci:l,searching:w,searchResult:g,noCorteActivo:a,uploading:n,searchByCI:R,uploadFactura:Q,confirmReplaceFactura:z,onRejected:P,viewFactura:i=>{if(!i.factura_path)return;let c=k.defaults.baseURL;c.endsWith("/api")&&(c=c.slice(0,-4));const u=`${c}/storage/${i.factura_path}`;window.open(u,"_blank")}}}},H={class:"row q-gutter-md"},K={key:0,class:"text-center q-pa-md"},X={key:1},Y={class:"row items-center no-wrap"},Z={class:"text-h6 text-weight-bold"},J={class:"text-subtitle2 opacity-80"},$={class:"text-subtitle1 q-mt-sm"},ee={class:"text-caption q-mt-xs text-italic opacity-80"},te={class:"row justify-between items-center"},ae={class:"text-subtitle1"},se={class:"text-caption"},oe={class:"text-right"},le={class:"text-h6"},re={class:"text-caption"},ie={key:0},de={key:0,class:"text-caption q-mt-xs"},ne={class:"row items-center q-col-gutter-md"},ce={class:"col-12 col-sm-8"},ue={class:"col-12 col-sm-4"},me={key:1},pe={class:"row items-center justify-between q-mb-md"},ve={class:"row items-center"},fe={class:"text-caption text-grey-8"},be={class:"row items-center q-col-gutter-md"},_e={class:"col-12 col-sm-8"},ge={class:"col-12 col-sm-4"},xe={key:2},ye={class:"row items-center"},he={class:"text-caption text-grey-8"},we={class:"text-caption text-positive q-mt-xs"};function qe(_,t,D,l,w,g){return d(),q(O,{class:"flex flex-center",style:{background:"linear-gradient(135deg, #663399 0%, #009999 100%)","min-height":"100vh"}},{default:o(()=>[s(h,{style:{width:"800px","max-width":"95vw"}},{default:o(()=>[s(v,{class:"bg-primary text-white text-center"},{default:o(()=>[...t[1]||(t[1]=[e("div",{class:"text-h5"},"SIRRED - B\xFAsqueda de Informaci\xF3n",-1),e("div",{class:"text-subtitle2"},"Universidad T\xE9cnica Privada Cosmos",-1)])]),_:1}),s(v,null,{default:o(()=>[s(T,{onSubmit:l.searchByCI,class:"q-mb-md"},{default:o(()=>[e("div",H,[s(E,{modelValue:l.ci,"onUpdate:modelValue":t[0]||(t[0]=a=>l.ci=a),label:"Ingrese su CI",outlined:"",dense:"",style:{flex:"1"},rules:[a=>!!a||"CI es requerido"]},null,8,["modelValue","rules"]),s(y,{type:"submit",label:"Buscar",color:"primary",icon:"search",loading:l.searching},null,8,["loading"])])]),_:1},8,["onSubmit"]),l.noCorteActivo?(d(),f("div",K,[s(p,{name:"info",size:"64px",color:"warning"}),t[2]||(t[2]=e("div",{class:"text-h6 q-mt-md"},"No hay ning\xFAn corte activo en este momento",-1)),t[3]||(t[3]=e("div",{class:"text-subtitle2"},"Por favor, contacte con el administrador",-1))])):l.searchResult?(d(),f("div",X,[s(h,{class:"bg-primary text-white q-mb-md shadow-2"},{default:o(()=>[s(v,null,{default:o(()=>[e("div",Y,[s(U,{size:"64px","font-size":"42px",color:"white","text-color":"primary",icon:"person",class:"q-mr-md"}),e("div",null,[e("div",Z,r(l.searchResult.docente.nombre)+" "+r(l.searchResult.docente.apellidos),1),e("div",J,"CI: "+r(l.searchResult.docente.ci),1),e("div",$,[s(S,{color:"secondary",class:"q-pa-xs text-body2"},{default:o(()=>[b(r(l.searchResult.corte_activo.nombre),1)]),_:1})]),e("div",ee," Periodo: "+r(new Date(l.searchResult.corte_activo.fecha_inicio+"T00:00:00").toLocaleDateString())+" - "+r(new Date(l.searchResult.corte_activo.fecha_fin+"T00:00:00").toLocaleDateString()),1)])])]),_:1})]),_:1}),(d(!0),f(j,null,L(l.searchResult.facturaciones,a=>(d(),f("div",{key:a.id,class:"q-mb-md"},[s(h,{bordered:""},{default:o(()=>[s(v,{class:"bg-grey-2"},{default:o(()=>[e("div",te,[e("div",null,[e("div",ae,[e("strong",null,r(a.sede_carrera.sede.nombre),1),b(" - "+r(a.sede_carrera.carrera.nombre),1)]),e("div",se,[t[4]||(t[4]=b(" Tipo: ",-1)),s(S,{color:a.tipo_contrato==="FACTURACION"?"primary":"grey"},{default:o(()=>[b(r(a.tipo_contrato),1)]),_:2},1032,["color"])])]),e("div",oe,[e("div",le,"Bs. "+r(a.monto),1),e("div",re,"Carga: "+r(a.carga_horaria)+" hrs",1)])])]),_:2},1024),a.tipo_contrato==="FACTURACION"?(d(),q(v,{key:0},{default:o(()=>[!a.estado_subida||a.estado_subida==="DENEGADO"?(d(),f("div",ie,[a.estado_subida==="DENEGADO"?(d(),q(C,{key:0,rounded:"",class:"bg-red-1 text-red-9 q-mb-md border-red"},{avatar:o(()=>[s(p,{name:"error",color:"red"})]),default:o(()=>[t[5]||(t[5]=e("div",{class:"text-weight-bold"},"Factura Denegada",-1)),t[6]||(t[6]=e("div",null,"Su factura fue denegada. Por favor, revise los requisitos y suba una nueva. ",-1)),a.fecha_subida?(d(),f("div",de," Fecha de subida anterior: "+r(new Date(a.fecha_subida).toLocaleDateString()),1)):F("",!0)]),_:2},1024)):F("",!0),e("div",ne,[e("div",ce,[s(B,{modelValue:a.file,"onUpdate:modelValue":n=>a.file=n,label:"Seleccionar Factura (PDF)",outlined:"",dense:"",accept:".pdf","max-file-size":"2097152",onRejected:l.onRejected},{prepend:o(()=>[s(p,{name:"attach_file"})]),_:1},8,["modelValue","onUpdate:modelValue","onRejected"]),t[7]||(t[7]=e("div",{class:"text-caption text-grey-7 q-mt-xs"}," Formato PDF, m\xE1x 2MB ",-1))]),e("div",ue,[s(y,{label:"Subir Factura",color:"primary",icon:"cloud_upload",class:"full-width",onClick:n=>l.uploadFactura(a),loading:l.uploading[a.id],disable:!a.file},null,8,["onClick","loading","disable"])])])])):a.estado_subida==="SUBIDA"?(d(),f("div",me,[s(h,{flat:"",bordered:"",class:"bg-blue-1 border-blue"},{default:o(()=>[s(v,null,{default:o(()=>[e("div",pe,[e("div",ve,[s(p,{name:"cloud_upload",color:"blue",size:"32px",class:"q-mr-md"}),e("div",null,[t[8]||(t[8]=e("div",{class:"text-subtitle1 text-weight-bold text-blue"}," Factura Subida Correctamente ",-1)),e("div",fe," Registrada el "+r(new Date(a.fecha_subida).toLocaleDateString()),1)])]),s(y,{flat:"",round:"",color:"primary",icon:"visibility",onClick:n=>l.viewFactura(a)},{default:o(()=>[s(V,null,{default:o(()=>[...t[9]||(t[9]=[b("Ver Factura",-1)])]),_:1})]),_:1},8,["onClick"])]),s(C,{class:"bg-warning text-white q-mb-md",rounded:""},{avatar:o(()=>[s(p,{name:"info"})]),default:o(()=>[t[10]||(t[10]=e("div",{class:"text-weight-bold"},"\xBFNecesita reemplazar su factura?",-1)),t[11]||(t[11]=e("div",{class:"text-caption"},"Si detect\xF3 un error, puede subir una nueva factura. La anterior ser\xE1 reemplazada.",-1))]),_:1}),e("div",be,[e("div",_e,[s(B,{modelValue:a.file,"onUpdate:modelValue":n=>a.file=n,label:"Seleccionar Nueva Factura (PDF)",outlined:"",dense:"",accept:".pdf","max-file-size":"2097152",onRejected:l.onRejected},{prepend:o(()=>[s(p,{name:"attach_file"})]),_:1},8,["modelValue","onUpdate:modelValue","onRejected"]),t[12]||(t[12]=e("div",{class:"text-caption text-grey-7 q-mt-xs"}," Formato PDF, m\xE1x 2MB ",-1))]),e("div",ge,[s(y,{label:"Reemplazar Factura",color:"warning",icon:"sync",class:"full-width",onClick:n=>l.confirmReplaceFactura(a),loading:l.uploading[a.id],disable:!a.file},null,8,["onClick","loading","disable"])])])]),_:2},1024)]),_:2},1024)])):a.estado_subida==="APROBADO"?(d(),f("div",xe,[s(h,{flat:"",bordered:"",class:"bg-green-1 border-green"},{default:o(()=>[s(v,{class:"row items-center justify-between"},{default:o(()=>[e("div",ye,[s(p,{name:"check_circle",color:"positive",size:"32px",class:"q-mr-md"}),e("div",null,[t[14]||(t[14]=e("div",{class:"text-subtitle1 text-weight-bold text-positive"}," Factura Aprobada ",-1)),e("div",he," Registrada el "+r(new Date(a.fecha_subida).toLocaleDateString()),1),e("div",we,[s(p,{name:"lock",size:"xs"}),t[13]||(t[13]=b(" No se puede modificar una factura aprobada ",-1))])])]),s(y,{flat:"",round:"",color:"primary",icon:"visibility",onClick:n=>l.viewFactura(a)},{default:o(()=>[s(V,null,{default:o(()=>[...t[15]||(t[15]=[b("Ver Factura",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1024)]),_:2},1024)])):F("",!0)]),_:2},1024)):(d(),q(v,{key:1},{default:o(()=>[s(C,{class:"bg-info text-white"},{avatar:o(()=>[s(p,{name:"info"})]),default:o(()=>[t[16]||(t[16]=b(" Este tipo de contrato es solo informativo. No requiere subir factura. ",-1))]),_:1})]),_:1}))]),_:2},1024)]))),128))])):F("",!0)]),_:1})]),_:1})]),_:1})}var Ne=G(W,[["render",qe]]);export{Ne as default};
