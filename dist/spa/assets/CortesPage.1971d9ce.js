import{z as d,f as F,n as A,o as V,c as _,w as r,H as f,a as t,L as v,I as q,K as y,M as w,Z as x,N as T,Q as k,bd as U,a0 as z,b5 as E}from"./index.0418bc8d.js";import{Q as L}from"./QBadge.81599d26.js";import{Q as D,a as M}from"./QTable.17f2e81d.js";import{Q as P}from"./QTooltip.616e6e1b.js";import{Q as G}from"./QBanner.09124be8.js";import{Q as R}from"./QForm.0e8df789.js";import{Q as j}from"./QPage.c34053e1.js";import{u as H}from"./use-quasar.d200e14e.js";import{api as h}from"./axios.0ee954dc.js";import{_ as K}from"./plugin-vue_export-helper.21dcd24c.js";import"./QList.329cacdc.js";import"./QSelect.e99ebc92.js";import"./QChip.9d792c62.js";import"./QItem.b86f3ea8.js";import"./position-engine.40d3e3b8.js";const O={name:"CortesPage",setup(){const m=H(),a=d([]),u=d(!1),o=d(!1),g=d(!1),c=d(!1),e=d({nombre:"",fecha_inicio:"",fecha_fin:"",estado:!1}),p=d(""),C=l=>{if(!l)return"";const s=new Date(l+"T00:00:00"),n=String(s.getDate()).padStart(2,"0"),i=String(s.getMonth()+1).padStart(2,"0"),b=s.getFullYear();return`${n}/${i}/${b}`},B=[{name:"nombre",label:"Nombre",field:"nombre",align:"left",sortable:!0},{name:"fecha_inicio",label:"Fecha Inicio",field:"fecha_inicio",align:"left",sortable:!0,format:l=>C(l)},{name:"fecha_fin",label:"Fecha Fin",field:"fecha_fin",align:"left",sortable:!0,format:l=>C(l)},{name:"estado",label:"Estado",field:"estado",align:"center"},{name:"actions",label:"Acciones",align:"center"}],I=F(()=>{if(!p.value)return a.value;const l=p.value.toLowerCase();return a.value.filter(s=>{var n,i,b;return((n=s.nombre)==null?void 0:n.toLowerCase().includes(l))||((i=s.fecha_inicio)==null?void 0:i.toLowerCase().includes(l))||((b=s.fecha_fin)==null?void 0:b.toLowerCase().includes(l))})}),Q=async()=>{u.value=!0;try{const l=localStorage.getItem("token"),s=await h.get("/cortes",{headers:{Authorization:`Bearer ${l}`}});a.value=s.data}catch{m.notify({type:"negative",message:"Error al cargar cortes"})}finally{u.value=!1}},N=(l=null)=>{l?(e.value={...l,estado:Boolean(l.estado)},c.value=!0):(e.value={nombre:"",fecha_inicio:"",fecha_fin:"",estado:!1},c.value=!1),g.value=!0},S=async()=>{var l,s;o.value=!0;try{const n=localStorage.getItem("token"),i={...e.value,estado:e.value.estado?1:0};c.value?(await h.put(`/cortes/${e.value.id}`,i,{headers:{Authorization:`Bearer ${n}`}}),m.notify({type:"positive",message:"Corte actualizado"})):(await h.post("/cortes",i,{headers:{Authorization:`Bearer ${n}`}}),m.notify({type:"positive",message:"Corte creado"})),g.value=!1,Q()}catch(n){m.notify({type:"negative",message:((s=(l=n.response)==null?void 0:l.data)==null?void 0:s.message)||"Error al guardar"})}finally{o.value=!1}};return A(()=>{Q()}),{cortes:a,loading:u,saving:o,showDialog:g,editMode:c,form:e,columns:B,searchQuery:p,filteredCortes:I,openDialog:N,saveCorte:S}}},Y={class:"q-mb-md"},Z={class:"row justify-between items-center q-mb-md"},J={class:"text-h6"},W={class:"row q-gutter-sm"};function X(m,a,u,o,g,c){return V(),_(j,{padding:""},{default:r(()=>[f("div",Y,[f("div",Z,[a[8]||(a[8]=f("div",{class:"text-h5 text-weight-medium"},"Gesti\xF3n de Cortes",-1)),t(v,{color:"primary",label:"Nuevo Corte",icon:"add",onClick:a[0]||(a[0]=e=>o.openDialog()),unelevated:""})]),t(y,{modelValue:o.searchQuery,"onUpdate:modelValue":a[1]||(a[1]=e=>o.searchQuery=e),outlined:"",dense:"",placeholder:"Buscar por nombre o fecha...",class:"q-mb-md",clearable:"",style:{"max-width":"400px"}},{prepend:r(()=>[t(q,{name:"search"})]),_:1},8,["modelValue"])]),t(M,{rows:o.filteredCortes,columns:o.columns,"row-key":"id",loading:o.loading,flat:"",bordered:"","rows-per-page-options":[10,25,50],class:"shadow-1"},{"body-cell-estado":r(e=>[t(D,{props:e},{default:r(()=>[t(L,{color:e.row.estado?"positive":"grey"},{default:r(()=>[w(x(e.row.estado?"ACTIVO":"Inactivo"),1)]),_:2},1032,["color"])]),_:2},1032,["props"])]),"body-cell-actions":r(e=>[t(D,{props:e},{default:r(()=>[t(v,{flat:"",dense:"",color:"primary",icon:"edit",onClick:p=>o.openDialog(e.row)},{default:r(()=>[t(P,null,{default:r(()=>[...a[9]||(a[9]=[w("Editar",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["props"])]),_:1},8,["rows","columns","loading"]),t(E,{modelValue:o.showDialog,"onUpdate:modelValue":a[7]||(a[7]=e=>o.showDialog=e)},{default:r(()=>[t(T,{style:{"min-width":"400px"}},{default:r(()=>[t(k,{class:"bg-primary text-white"},{default:r(()=>[f("div",J,x(o.editMode?"Editar Corte":"Nuevo Corte"),1)]),_:1}),t(k,null,{default:r(()=>[t(R,{onSubmit:o.saveCorte},{default:r(()=>[t(y,{modelValue:o.form.nombre,"onUpdate:modelValue":a[2]||(a[2]=e=>o.form.nombre=e),label:"Nombre",outlined:"",dense:"",class:"q-mb-md",rules:[e=>!!e||"Requerido"]},null,8,["modelValue","rules"]),t(y,{modelValue:o.form.fecha_inicio,"onUpdate:modelValue":a[3]||(a[3]=e=>o.form.fecha_inicio=e),label:"Fecha de Inicio",type:"date",outlined:"",dense:"",class:"q-mb-md",rules:[e=>!!e||"Requerido"]},null,8,["modelValue","rules"]),t(y,{modelValue:o.form.fecha_fin,"onUpdate:modelValue":a[4]||(a[4]=e=>o.form.fecha_fin=e),label:"Fecha de Fin",type:"date",outlined:"",dense:"",class:"q-mb-md"},null,8,["modelValue"]),t(U,{modelValue:o.form.estado,"onUpdate:modelValue":a[5]||(a[5]=e=>o.form.estado=e),label:"Activar este corte",color:"positive",class:"q-mb-md"},null,8,["modelValue"]),o.form.estado?(V(),_(G,{key:0,class:"bg-warning text-white q-mb-md"},{avatar:r(()=>[t(q,{name:"warning"})]),default:r(()=>[a[10]||(a[10]=w(" Al activar este corte, todos los dem\xE1s se desactivar\xE1n autom\xE1ticamente. ",-1))]),_:1})):z("",!0),f("div",W,[t(v,{label:"Cancelar",color:"grey",flat:"",onClick:a[6]||(a[6]=e=>o.showDialog=!1)}),t(v,{type:"submit",label:"Guardar",color:"primary",loading:o.saving},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var ge=K(O,[["render",X]]);export{ge as default};
