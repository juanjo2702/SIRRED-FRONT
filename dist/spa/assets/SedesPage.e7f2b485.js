import{d as $,f as O,h as ee,g as ae,z as u,n as re,o as m,c as p,w as r,H as d,a,L as f,I as L,K as z,M as g,Z as v,a0 as D,X as B,az as M,be as le,$ as T,_ as U,N as G,Q,b5 as P,J as oe,bf as te,bc as se,au as ne}from"./index.0418bc8d.js";import{Q as I}from"./QBadge.81599d26.js";import{Q as S}from"./QTooltip.616e6e1b.js";import{Q as _,a as ie}from"./QTable.17f2e81d.js";import{Q as de}from"./QChip.9d792c62.js";import{Q as ce}from"./QForm.0e8df789.js";import{a as ue,b as j,Q as me}from"./QItem.b86f3ea8.js";import{Q as fe}from"./QList.329cacdc.js";import{Q as ve}from"./QPage.c34053e1.js";import{u as ge}from"./use-quasar.d200e14e.js";import{api as C}from"./axios.0ee954dc.js";import{_ as ye}from"./plugin-vue_export-helper.21dcd24c.js";import"./position-engine.40d3e3b8.js";import"./QSelect.e99ebc92.js";var H=$({name:"QTr",props:{props:Object,noHover:Boolean},setup(i,{slots:o}){const w=O(()=>"q-tr"+(i.props===void 0||i.props.header===!0?"":" "+i.props.__trClass)+(i.noHover===!0?" q-tr--no-hover":""));return()=>{var l;return ee("tr",{style:(l=i.props)==null?void 0:l.__trStyle,class:w.value},ae(o.default))}}});const be={name:"SedesPage",setup(){const i=ge(),o=u([]),w=u([]),l=u(!1),x=u(!1),h=u(!1),e=u(!1),t=u(!1),n=u({nombre:"",abreviacion:""}),y=u(null),k=u([]),V=u(""),F=[{name:"nombre",label:"Nombre",field:"nombre",align:"left",sortable:!0},{name:"abreviacion",label:"Abreviaci\xF3n",field:"abreviacion",align:"left",sortable:!0},{name:"carreras",label:"Carreras",align:"left"},{name:"actions",label:"Acciones",align:"center"}],R=O(()=>{if(!V.value)return o.value;const s=V.value.toLowerCase();return o.value.filter(c=>{var b;return(b=c.nombre)==null?void 0:b.toLowerCase().includes(s)})}),A=async()=>{l.value=!0;try{const s=localStorage.getItem("token"),c=await C.get("/sedes",{headers:{Authorization:`Bearer ${s}`}});o.value=c.data}catch{i.notify({type:"negative",message:"Error al cargar sedes"})}finally{l.value=!1}},Z=async()=>{try{const s=localStorage.getItem("token"),c=await C.get("/carreras",{headers:{Authorization:`Bearer ${s}`}});w.value=c.data}catch{i.notify({type:"negative",message:"Error al cargar carreras"})}},J=(s=null)=>{s?(n.value={...s},t.value=!0):(n.value={nombre:"",abreviacion:""},t.value=!1),h.value=!0},K=async()=>{x.value=!0;try{const s=localStorage.getItem("token");t.value?(await C.put(`/sedes/${n.value.id}`,n.value,{headers:{Authorization:`Bearer ${s}`}}),i.notify({type:"positive",message:"Sede actualizada"})):(await C.post("/sedes",n.value,{headers:{Authorization:`Bearer ${s}`}}),i.notify({type:"positive",message:"Sede creada"})),h.value=!1,A()}catch{i.notify({type:"negative",message:"Error al guardar"})}finally{x.value=!1}},X=s=>{var c;y.value=s,k.value=((c=s.sede_carreras)==null?void 0:c.map(b=>b.carrera_id))||[],e.value=!0},W=async()=>{var s,c;if(!!y.value){x.value=!0;try{const b=localStorage.getItem("token"),q=await C.post(`/sedes/${y.value.id}/sync-carreras`,{carrera_ids:k.value},{headers:{Authorization:`Bearer ${b}`}}),N=o.value.findIndex(Y=>Y.id===y.value.id);N!==-1&&(o.value[N]=q.data),i.notify({type:"positive",message:"Carreras actualizadas correctamente"}),E()}catch(b){const q=((c=(s=b.response)==null?void 0:s.data)==null?void 0:c.message)||"Error al actualizar carreras";i.notify({type:"negative",message:q})}finally{x.value=!1}}},E=()=>{e.value=!1,y.value=null,k.value=[]};return re(()=>{A(),Z()}),{sedes:o,carreras:w,loading:l,saving:x,showDialog:h,showCarrerasDialog:e,editMode:t,form:n,columns:F,selectedSede:y,selectedCarreras:k,searchQuery:V,filteredSedes:R,openDialog:J,saveSede:K,manageCarreras:X,syncCarreras:W,closeCarrerasDialog:E}}},pe={class:"q-mb-md"},_e={class:"row justify-between items-center q-mb-md"},xe={class:"row items-center q-gutter-xs"},we={key:1,class:"text-grey-5 text-caption"},Ce={class:"row items-center q-gutter-xs"},he={class:"q-pa-md bg-grey-1"},ke={class:"row q-gutter-xs"},Qe={class:"text-h6"},Se={class:"row q-gutter-sm"},Ve={class:"text-h6"},qe={class:"text-body2 text-grey-7"};function ze(i,o,w,l,x,h){return m(),p(ve,{padding:""},{default:r(()=>[d("div",pe,[d("div",_e,[o[8]||(o[8]=d("div",{class:"text-h5 text-weight-medium"},"Gesti\xF3n de Sedes",-1)),a(f,{color:"primary",label:"Nueva Sede",icon:"add",onClick:o[0]||(o[0]=e=>l.openDialog()),unelevated:""})]),a(z,{modelValue:l.searchQuery,"onUpdate:modelValue":o[1]||(o[1]=e=>l.searchQuery=e),outlined:"",dense:"",placeholder:"Buscar por nombre de sede...",class:"q-mb-md",clearable:"",style:{"max-width":"400px"}},{prepend:r(()=>[a(L,{name:"search"})]),_:1},8,["modelValue"])]),a(ie,{rows:l.filteredSedes,columns:l.columns,"row-key":"id",loading:l.loading,flat:"",bordered:"","rows-per-page-options":[10,25,50],class:"shadow-1"},{"body-cell-carreras":r(e=>[a(_,{props:e},{default:r(()=>{var t,n;return[d("div",xe,[a(I,{color:"secondary",label:`${((t=e.row.sede_carreras)==null?void 0:t.length)||0} carreras`,class:"q-px-sm"},null,8,["label"]),((n=e.row.sede_carreras)==null?void 0:n.length)>0?(m(),p(f,{key:0,flat:"",dense:"",round:"",size:"sm",color:"grey-7",icon:"visibility",onClick:y=>e.expand=!e.expand},{default:r(()=>[a(S,null,{default:r(()=>[g(v(e.expand?"Ocultar":"Ver")+" carreras",1)]),_:2},1024)]),_:2},1032,["onClick"])):D("",!0)])]}),_:2},1032,["props"])]),"body-cell-expand":r(e=>[a(_,{props:e,"auto-width":""},{default:r(()=>{var t;return[((t=e.row.sede_carreras)==null?void 0:t.length)>0?(m(),p(f,{key:0,size:"sm",color:"grey-7",round:"",dense:"",onClick:n=>e.expand=!e.expand,icon:e.expand?"expand_less":"expand_more"},null,8,["onClick","icon"])):D("",!0)]}),_:2},1032,["props"])]),body:r(e=>[a(H,{props:e},{default:r(()=>[a(_,{key:"nombre",props:e},{default:r(()=>[g(v(e.row.nombre),1)]),_:2},1032,["props"]),a(_,{key:"abreviacion",props:e},{default:r(()=>[e.row.abreviacion?(m(),p(I,{key:0,color:"primary",outline:""},{default:r(()=>[g(v(e.row.abreviacion),1)]),_:2},1024)):(m(),B("span",we,"Sin abreviaci\xF3n"))]),_:2},1032,["props"]),a(_,{key:"carreras",props:e},{default:r(()=>{var t,n;return[d("div",Ce,[a(I,{color:"secondary",label:`${((t=e.row.sede_carreras)==null?void 0:t.length)||0} carreras`,class:"q-px-sm"},null,8,["label"]),((n=e.row.sede_carreras)==null?void 0:n.length)>0?(m(),p(f,{key:0,flat:"",dense:"",round:"",size:"sm",color:"grey-7",icon:"visibility",onClick:y=>e.expand=!e.expand},{default:r(()=>[a(S,null,{default:r(()=>[g(v(e.expand?"Ocultar":"Ver")+" carreras",1)]),_:2},1024)]),_:2},1032,["onClick"])):D("",!0)])]}),_:2},1032,["props"]),a(_,{key:"actions",props:e},{default:r(()=>[a(f,{flat:"",dense:"",color:"primary",icon:"edit",onClick:t=>l.openDialog(e.row)},{default:r(()=>[a(S,null,{default:r(()=>[...o[9]||(o[9]=[g("Editar",-1)])]),_:1})]),_:1},8,["onClick"]),a(f,{flat:"",dense:"",color:"secondary",icon:"link",onClick:t=>l.manageCarreras(e.row)},{default:r(()=>[a(S,null,{default:r(()=>[...o[10]||(o[10]=[g("Gestionar Carreras",-1)])]),_:1})]),_:1},8,["onClick"])]),_:2},1032,["props"])]),_:2},1032,["props"]),M(a(H,{props:e},{default:r(()=>[a(_,{colspan:"100%"},{default:r(()=>[d("div",he,[o[11]||(o[11]=d("div",{class:"text-subtitle2 text-grey-8 q-mb-sm"},"Carreras asignadas:",-1)),d("div",ke,[(m(!0),B(U,null,T(e.row.sede_carreras,t=>(m(),p(de,{key:t.id,color:"secondary","text-color":"white",size:"sm",dense:""},{default:r(()=>{var n;return[g(v((n=t.carrera)==null?void 0:n.nombre),1)]}),_:2},1024))),128))])])]),_:2},1024)]),_:2},1032,["props"]),[[le,e.expand]])]),_:1},8,["rows","columns","loading"]),a(P,{modelValue:l.showDialog,"onUpdate:modelValue":o[5]||(o[5]=e=>l.showDialog=e)},{default:r(()=>[a(G,{style:{"min-width":"400px"}},{default:r(()=>[a(Q,{class:"bg-primary text-white"},{default:r(()=>[d("div",Qe,v(l.editMode?"Editar Sede":"Nueva Sede"),1)]),_:1}),a(Q,null,{default:r(()=>[a(ce,{onSubmit:l.saveSede},{default:r(()=>[a(z,{modelValue:l.form.nombre,"onUpdate:modelValue":o[2]||(o[2]=e=>l.form.nombre=e),label:"Nombre",outlined:"",dense:"",class:"q-mb-md",rules:[e=>!!e||"Requerido"]},null,8,["modelValue","rules"]),a(z,{modelValue:l.form.abreviacion,"onUpdate:modelValue":o[3]||(o[3]=e=>l.form.abreviacion=e),label:"Abreviaci\xF3n (para facturas)",outlined:"",dense:"",class:"q-mb-md",hint:"Ej: LP, EA, SCZ (M\xE1x 10 caracteres)",rules:[e=>!e||e.length<=10||"M\xE1ximo 10 caracteres"]},null,8,["modelValue","rules"]),d("div",Se,[a(f,{label:"Cancelar",color:"grey",flat:"",onClick:o[4]||(o[4]=e=>l.showDialog=!1)}),a(f,{type:"submit",label:"Guardar",color:"primary",loading:l.saving},null,8,["loading"])])]),_:1},8,["onSubmit"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(P,{modelValue:l.showCarrerasDialog,"onUpdate:modelValue":o[7]||(o[7]=e=>l.showCarrerasDialog=e)},{default:r(()=>[a(G,{style:{"min-width":"500px","max-width":"600px"}},{default:r(()=>[a(Q,{class:"bg-secondary text-white"},{default:r(()=>{var e;return[d("div",Ve,"Carreras de "+v((e=l.selectedSede)==null?void 0:e.nombre),1),o[12]||(o[12]=d("div",{class:"text-caption"},"Seleccione las carreras disponibles en esta sede",-1))]}),_:1}),a(Q,{class:"q-pt-md",style:{"max-height":"400px","overflow-y":"auto"}},{default:r(()=>[a(fe,null,{default:r(()=>[(m(!0),B(U,null,T(l.carreras,e=>M((m(),p(ue,{key:e.id,tag:"label",clickable:""},{default:r(()=>[a(j,{avatar:""},{default:r(()=>[a(se,{modelValue:l.selectedCarreras,"onUpdate:modelValue":o[6]||(o[6]=t=>l.selectedCarreras=t),val:e.id,color:"secondary"},null,8,["modelValue","val"])]),_:2},1024),a(j,null,{default:r(()=>[a(me,null,{default:r(()=>[g(v(e.nombre),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)),[[ne]])),128))]),_:1}),a(oe,{class:"q-my-md"}),d("div",qe,[a(L,{name:"info",size:"18px",class:"q-mr-xs"}),g(" "+v(l.selectedCarreras.length)+" de "+v(l.carreras.length)+" carreras seleccionadas ",1)])]),_:1}),a(te,{align:"right",class:"q-pa-md"},{default:r(()=>[a(f,{label:"Cancelar",color:"grey-7",flat:"",onClick:l.closeCarrerasDialog},null,8,["onClick"]),a(f,{label:"Guardar",color:"secondary",onClick:l.syncCarreras,loading:l.saving,unelevated:""},null,8,["onClick","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})}var Oe=ye(be,[["render",ze]]);export{Oe as default};
